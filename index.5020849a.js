var t={};class e{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.state=JSON.parse(JSON.stringify(t)),this.status=e.STATUS_IDLE,this.score=0}static STATUS_IDLE="idle";static STATUS_PLAYING="playing";static STATUS_WIN="win";static STATUS_LOSE="lose";moveLeft(){let t=this.getState();for(let e=0;e<4;e++){let s=[];for(let r=0;r<4;r++){let a=t[e][r];a&&s.push(a)}for(let t=0;t<s.length;t++){let e=s[t],r=t+1<s.length?s[t+1]:null;if(!r)break;if(e===r){let r=this.getScore()+2*e;this.score=r,s.splice(t,2,2*e)}}if(4!==s.length){for(;s.length<4;)s.push(0);for(let r=0;r<4;r++)t[e][r]=s[r]}}}moveRight(){this.reverseStateByRows(),this.moveLeft(),this.reverseStateByRows()}moveUp(){this.rotateStateBackwardBy90Deg(),this.moveLeft(),this.rotateStateForwardBy90Deg()}moveDown(){this.rotateStateForwardBy90Deg(),this.moveLeft(),this.rotateStateBackwardBy90Deg()}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.state=JSON.parse(JSON.stringify(this.initialState)),this.status=e.STATUS_PLAYING,this.score=0,this.addRandomDigitToEmptyCell(2)}restart(){this.state=JSON.parse(JSON.stringify(this.initialState)),this.status=e.STATUS_IDLE,this.score=0}rotateStateBackwardBy90Deg(){let t=this.getState(),e=JSON.parse(JSON.stringify(t));for(let s=3;s>=0;s--)for(let r=0;r<4;r++)t[3-s][r]=e[r][s]}rotateStateForwardBy90Deg(){let t=this.getState(),e=JSON.parse(JSON.stringify(t));for(let s=3;s>=0;s--)for(let r=0;r<4;r++)t[r][3-s]=e[s][r]}reverseStateByRows(){let t=this.getState();for(let e=0;e<4;e++)t[e].reverse()}checkIsPlayerWin(){let t=this.getState(),e=!1;for(let s=0;s<4;s++)t[s].includes(2048)&&(e=!0);return e}checkIsPlayerLose(){let t=this.getState(),e=!1,s=!1,r=!1;for(let e=0;e<4;e++)if(t[e].includes(0)){s=!0;break}for(let e=0;e<4;e++)for(let s=0;s<3;s++)if(t[e][s]===t[e][s+1]){r=!0;break}for(let e=0;e<4;e++)for(let s=0;s<3;s++)if(t[s][e]===t[s+1][e]){r=!0;break}return s||r||(e=!0),e}addRandomDigitToEmptyCell(t){let e=this.getState(),s=0;for(;s<t;){let[t,r]=this.getRandomCoordinates(),a=this.getRandomDigit();!e[t][r]&&(e[t][r]=a,s++)}}getRandomCoordinates(){return[Math.floor(4*Math.random()),Math.floor(4*Math.random())]}getRandomDigit(){return Math.floor(100*Math.random())+1>90?4:2}}const s=new(t=e),r=document.querySelector("table").tBodies[0],a=document.querySelector("button"),i=document.querySelector(".message-start"),o=document.querySelector(".message-lose"),l=document.querySelector(".message-win"),n=document.querySelector(".game-score");function c(){let t=s.getState();for(let e=0;e<4;e++)for(let s=0;s<4;s++){let a=t[e][s];if(!a){r.rows[e].cells[s].className="field-cell",r.rows[e].cells[s].innerText="";continue}r.rows[e].cells[s].className=`field-cell field-cell--${a}`,r.rows[e].cells[s].innerText=`${a}`}}a.addEventListener("click",()=>{if(a.classList.contains("restart")){s.restart(),a.classList.remove("restart"),a.classList.add("start"),a.textContent="Start",i.classList.remove("hidden"),o.classList.add("hidden"),l.classList.add("hidden"),n.innerText="0",c();return}s.start(),i.classList.add("hidden"),c()}),document.addEventListener("keydown",e=>{let r=e.key;if("ArrowRight"===r||"ArrowLeft"===r||"ArrowUp"===r||"ArrowDown"===r){let e=s.getState(),i=s.getStatus();if(i===t.STATUS_IDLE||i===t.STATUS_LOSE||i===t.STATUS_WIN)return;a.classList.contains("start")&&(a.classList.remove("start"),a.classList.add("restart"),a.textContent="Restart");let S=JSON.stringify(e);switch(r){case"ArrowRight":s.moveRight();break;case"ArrowLeft":s.moveLeft();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown()}if(S===JSON.stringify(e))return;if(n.innerText=`${s.getScore()}`,s.addRandomDigitToEmptyCell(1),c(),s.checkIsPlayerWin()){s.status=t.STATUS_WIN,l.classList.remove("hidden");return}s.checkIsPlayerLose()&&(s.status=t.STATUS_LOSE,o.classList.remove("hidden"))}});
//# sourceMappingURL=index.5020849a.js.map
